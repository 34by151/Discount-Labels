(o=>{function i(){this.prices={},this.changedPrice=!1,this.productTimer=[],this.init=this.init.bind(this),this.onFoundVariation=this.onFoundVariation.bind(this),this.onHideVariation=this.onHideVariation.bind(this),this.listeners=this.listeners.bind(this),this.delayLivePricing=this.delayLivePricing.bind(this),this.livePricing=this.livePricing.bind(this),this.countDownTimer=this.countDownTimer.bind(this),this.stopCountdownTimer=this.stopCountdownTimer.bind(this),this.changePrice=this.changePrice.bind(this),this.changePriceByBulk=this.changePriceByBulk.bind(this),this.setProductPrice=this.setProductPrice.bind(this),this.setVariationPrice=this.setVariationPrice.bind(this),this.getProductPrice=this.getProductPrice.bind(this),this.getProductRegularPrice=this.getProductRegularPrice.bind(this),this.getVariationPrice=this.getVariationPrice.bind(this),this.getVariationRegularPrice=this.getVariationRegularPrice.bind(this),this.tracks=this.tracks.bind(this),this.init()}i.prototype.init=function(){this.$bulkTables=o(".wccs-bulk-pricing-table-container"),this.$bulkTitles=o(".wccs-bulk-pricing-table-title"),this.$messages=o(".wccs-purchase-message, .wccs-shortcode-purchase-message"),o(".variations_form").length&&(this.$parentTable=this.$bulkTables.not("[data-variation]"),this.$parentTableTitle=this.$bulkTitles.not("[data-variation]"),this.$parentMessage=this.$messages.not("[data-variation]"),this.$variationForm=o(".variations_form").first(),o(document.body).on("found_variation.wccs_product_pricing",this.$variationForm,this.onFoundVariation),o(document.body).on("hide_variation.wccs_product_pricing",this.$variationForm,this.onHideVariation)),this.$cartForm=o(".product form.cart").first(),this.$livePriceContainer=o(".wccs-live-price-container"),this.$countdownTimer=o(".wccs-countdown-timer-container"),this.changePrice(),this.$variationForm||this.delayLivePricing(500),this.listeners(),this.tracks()},i.prototype.listeners=function(){var t=this;this.$cartForm.on("change keyup","input, select, textarea, .qty",function(){"variation_id"!==o(this).attr("name")&&(t.changePrice(),t.delayLivePricing(500))}),wccs_product_pricing_params.set_min_quantity&&1==wccs_product_pricing_params.set_min_quantity&&this.$cartForm.on("change","input.qty",function(){var i=o(this).attr("min"),i=(null!=i&&""!==i&&!1!==i&&parseFloat(o(this).val())<parseFloat(i)&&o(this).val(i),o(this).attr("max"));null!=i&&""!==i&&!1!==i&&parseFloat(o(this).val())>parseFloat(i)&&o(this).val(i)}),this.$cartForm.on("woocommerce-product-addons-update.wccs_product_pricing",function(){t.changePrice(),t.delayLivePricing(500)}),o(window).on("tc-epo-after-update",function(i){t.changePrice(),t.delayLivePricing(500)})},i.prototype.onFoundVariation=function(i,t){this.$bulkTables.length&&(this.$bulkTables.hide(),this.$bulkTitles.hide(),this.$bulkTables.filter('[data-variation="'+t.variation_id+'"]').length?(this.$bulkTables.filter('[data-variation="'+t.variation_id+'"]').show(),this.$bulkTitles.filter('[data-variation="'+t.variation_id+'"]').show()):this.$parentTable.length&&(this.$parentTable.show(),this.$parentTableTitle.show()),this.changePrice()),this.$messages.length&&(this.$messages.hide(),this.$messages.filter('[data-variation="'+t.variation_id+'"]').length?this.$messages.filter('[data-variation="'+t.variation_id+'"]').show():this.$parentMessage.length&&this.$parentMessage.show()),this.delayLivePricing(500)},i.prototype.onHideVariation=function(i){this.$bulkTables.length&&(this.$bulkTables.hide(),this.$bulkTitles.hide(),this.$parentTable.length&&(this.$parentTable.show(),this.$parentTableTitle.show()),this.changePrice()),this.$messages.length&&(this.$messages.hide(),this.$parentMessage.length)&&this.$parentMessage.show()},i.prototype.delayLivePricing=function(i){if(!i)return this.livePricing();this.delayedLivePricing&&clearTimeout(this.delayedLivePricing),this.delayedLivePricing=setTimeout(this.livePricing,i)},i.prototype.livePricing=function(){var i,r,t,a,n=(n=(n=o('input[name="variation_id"').val())||o('button[name="add-to-cart"]').val())||o('input[name="add-to-cart"').val();if(this.changedPrice){if(!wccs_product_pricing_params.display_countdown_timer||0==wccs_product_pricing_params.display_countdown_timer)return;if(!n||isNaN(+n)||+n<=0)return;if(this.productTimer.length&&-1<this.productTimer.indexOf(+n))return}(wccs_product_pricing_params.display_live_price&&1==wccs_product_pricing_params.display_live_price||wccs_product_pricing_params.display_live_total_price&&1==wccs_product_pricing_params.display_live_total_price||wccs_product_pricing_params.display_countdown_timer&&0!=wccs_product_pricing_params.display_countdown_timer)&&this.$cartForm.length&&(this.$livePriceContainer=this.$livePriceContainer.length?this.$livePriceContainer:o(".wccs-live-price-container"),this.$countdownTimer=this.$countdownTimer.length?this.$countdownTimer:o(".wccs-countdown-timer-container"),this.$livePriceContainer.length||this.$countdownTimer.length)&&(this.livePriceRunning?this.delayLivePricing(500):(t="",this.changedPrice||!wccs_product_pricing_params.display_live_price||1!=wccs_product_pricing_params.display_live_price||o(".wccs-live-price",this.$livePriceContainer).length||(t=(t+='<div class="wccs-live-price-section wccs-live-price-price-section">')+(wccs_product_pricing_params.live_pricing_label?"<span>"+wccs_product_pricing_params.live_pricing_label+":</span> ":"")+'<span class="wccs-live-price price"></span></div>'),this.changedPrice||!wccs_product_pricing_params.display_live_total_price||1!=wccs_product_pricing_params.display_live_total_price||o(".wccs-live-total-price",this.$livePriceContainer).length||(t=(t+='<div class="wccs-live-price-section wccs-live-price-total-price-section">')+(wccs_product_pricing_params.live_pricing_total_label?"<span>"+wccs_product_pricing_params.live_pricing_total_label+":</span> ":"")+'<span class="wccs-live-total-price price"></span></div>'),!this.changedPrice&&t.length&&this.$livePriceContainer.html(t),this.changedPrice||(o(".wccs-live-price, .wccs-live-total-price",this.$livePriceContainer).html(""),i=0,r=setInterval(function(){0==i++%5?o(".wccs-live-price, .wccs-live-total-price",this.$livePriceContainer).html("."):o(".wccs-live-price, .wccs-live-total-price",this.$livePriceContainer).append(".")},250)),this.livePriceRunning=!0,t=this.$cartForm.serialize(),a=this,/add-to-cart=/gi.test(t)||(t+="&add-to-cart="+wccs_product_pricing_params.product_id),o.ajax({url:wccs_product_pricing_params.ajaxurl,type:"POST",dataType:"json",data:{action:"wccs_live_price",nonce:wccs_product_pricing_params.nonce,data:t}}).done(function(i){if(clearInterval(r),i&&1==i.success&&i.data){if(!a.changedPrice&&wccs_product_pricing_params.display_live_price&&1==wccs_product_pricing_params.display_live_price)if(!1!==i.data.price){var t="";if(i.data.prices_quantities){var e,c=0;for(e in i.data.prices_quantities)t+='<div class="wccs-live-price-qty"><span class="wccs-live-price-qty-price">'+e+'</span> <span class="wccs-live-price-qty-quantity"> &times; '+i.data.prices_quantities[e]+"</span></div>",++c;1==c&&e?t=e:(t=t.length?'<div class="wccs-live-price-qty-container">'+t+"</div>":"").length&&i.data.prices_quantities_sum&&(t+='<div class="wccs-live-price-qty-total"><span>'+i.data.prices_quantities_sum+"</span></div>")}o(".wccs-live-price",a.$livePriceContainer).html(t.length?t:i.data.price)}else null!==i.data.main_price&&"always"===wccs_product_pricing_params.live_price_display_type&&o(".wccs-live-price",a.$livePriceContainer).html(i.data.main_price);!a.changedPrice&&wccs_product_pricing_params.display_live_total_price&&1==wccs_product_pricing_params.display_live_total_price&&(!1!==i.data.price?o(".wccs-live-total-price",a.$livePriceContainer).html(i.data.total_price):null!=i.data.main_total_price&&"always"===wccs_product_pricing_params.live_price_display_type&&o(".wccs-live-total-price",a.$livePriceContainer).html(i.data.main_total_price)),wccs_product_pricing_params.display_countdown_timer&&0!=wccs_product_pricing_params.display_countdown_timer&&(i.data.remaining_time?a.countDownTimer(i.data.remaining_time):a.stopCountdownTimer()),n&&!isNaN(+n)&&0<+n&&-1==a.productTimer.indexOf(+n)&&a.productTimer.push(+n),a.changedPrice||(!1!==i.data.price||null!=i.data.main_price&&"always"===wccs_product_pricing_params.live_price_display_type?a.$livePriceContainer.slideDown():a.$livePriceContainer.slideUp().html(""))}else a.stopCountdownTimer(),a.changedPrice||a.$livePriceContainer.slideUp().html("")}).fail(function(){a.stopCountdownTimer(),a.changedPrice||a.$livePriceContainer.slideUp().html("")}).always(function(){a.livePriceRunning=!1,clearInterval(r)})))},i.prototype.countDownTimer=function(i){this.flipDown?(!1===this.flipDown.remainingTime||i<this.flipDown.remainingTime)&&this.flipDown.updateTime({type:"remainingTime",value:i-1}):(this.$countdownTimer.slideDown(),this.flipDown=new FlipDown({type:"remainingTime",value:i-1},"wccs-countdown-timer-content",{headingPosition:"bottom",daysLabel:wccs_product_pricing_params.countdown_timer_days,hoursLabel:wccs_product_pricing_params.countdown_timer_hours,minutesLabel:wccs_product_pricing_params.countdown_timer_minutes,secondsLabel:wccs_product_pricing_params.countdown_timer_seconds}).start())},i.prototype.stopCountdownTimer=function(){this.flipDown&&(this.flipDown.stop(),this.flipDown=!1,this.$countdownTimer.slideUp().html(""))},i.prototype.changePrice=function(){var i,t;this.changedPrice=!1,!this.$bulkTables.length||"undefined"!==wccs_product_pricing_params.bulk_pricing_change_price&&"server"===wccs_product_pricing_params.bulk_pricing_change_price||(t=(t=o('button[name="add-to-cart"]').val())||o('input[name="add-to-cart"').val(),i=o('input[name="variation_id"').val(),0<t&&(this.changedPrice=this.changePriceByBulk(t,!1)),0<i&&(t=this.changePriceByBulk(i,!0),this.changedPrice=t||this.changedPrice))},i.prototype.changePriceByBulk=function(i,t){var e,c,r,a,n,s;if(this.$bulkTables.length)return e=t?this.getVariationPrice(i):this.getProductPrice(i),c=void 0!==wccs_product_pricing_params.variation_pirce_update&&1==wccs_product_pricing_params.variation_pirce_update,(r=o('.wccs-bulk-pricing-table-container[data-product="'+i+'"]')).length?!(a=o(".qty",this.$cartForm).val())||isNaN(+a)||+a<=0?(t&&(this.setVariationPrice(e,i),!c)||this.setProductPrice(e,i),!1):(o('td[data-type="price"]',r).each(function(){var i=o(this),t=i.data("quantity-min"),e=i.data("quantity-max"),t=t&&!isNaN(+t)?+t:"",e=e&&!isNaN(+e)&&0<+e?+e:"";if(""!=t&&t<=a&&(""===e||a<=e))return n=i,!1}),t?(s=n?n.html():e,this.setVariationPrice(s,i),c&&this.setProductPrice(s,i)):(s=n?n.html():e,this.setProductPrice(s,i)),!0):(t&&!c||this.setProductPrice(e,i),!1)},i.prototype.setProductPrice=function(i,t){/<del/.test(i)||(t=this.getProductRegularPrice(t))&&t!=i&&(i='<del aria-hidden="true">'+t+"</del> <ins>"+i+"</ins>"),o(".product .price, .product .wc-block-components-product-price").first().html(i)},i.prototype.setVariationPrice=function(i,t){/<del/.test(i)||(t=this.getVariationRegularPrice(t))&&t!=i&&(i='<del aria-hidden="true">'+t+"</del> <ins>"+i+"</ins>"),o(".woocommerce-variation .price").first().html(i)},i.prototype.getProductPrice=function(i){if(!i)return!1;if(!this.prices[i]){var t=o(".product .price, .product .wc-block-components-product-price").first();if(!t||!t.length)return!1;this.prices[i]=t.html()}return this.prices[i]},i.prototype.getProductRegularPrice=function(i){var t,i=this.getProductPrice(i);return!!i&&((t=i.match(/<del\b[^>]*>(.*?)<\/del>/i))?t[1]:i)},i.prototype.getVariationPrice=function(i){if(!i)return!1;if(!this.prices[i]){var t=o(".woocommerce-variation .price").first();if(!t||!t.length)return!1;this.prices[i]=t.html()}return this.prices[i]},i.prototype.getVariationRegularPrice=function(i){var t,i=this.getVariationPrice(i);return!!i&&((t=i.match(/<del\b[^>]*>(.*?)<\/del>/i))?t[1]:i)},i.prototype.tracks=function(){var i;void 0===wccs_product_pricing_params.analytics||wccs_product_pricing_params.analytics<=0||!(i=(i=(i=o('button[name="add-to-cart"]').val())||o('input[name="add-to-cart"').val())||void 0===wccs_product_pricing_params.product_id?i:wccs_product_pricing_params.product_id)||+i<=0||o.ajax({url:wccs_product_pricing_params.ajaxurl,type:"POST",dataType:"json",data:{action:"asnp_wccs_product_tracks",nonce:wccs_product_pricing_params.nonce,product_id:i}})};var t,e={getInstance:function(){return t=t||new i}};o.fn.wccs_get_product_pricing=function(){return e.getInstance()},o(function(){o().wccs_get_product_pricing()})})(jQuery);